import"fancybox";import utils from"@bigcommerce/stencil-utils";import PageManager from"./page-manager";import haloAddOptionForProduct from"./halothemes/haloAddOptionForProduct";import haloSidebarToggle from"./halothemes/haloSidebarToggle";import{conforms}from"lodash";export default class Blog extends PageManager{constructor(t){super(t)}onReady(){haloSidebarToggle(),this.loadOptionForProductCard(this.context),this.animationScroll(),this.getBlogPostByTag(".blog-tab-content__post--recenzii"),this.getBlogPostByTag(".blog-tab-content__post--recomandari"),this.getBlogPostByTag(".blog-tab-content__post--incurajare"),this.getBlogPostByTag(".blog-tab-content__post--interviuri"),this.viewMoreBlogCategory(),this.getTimeBlog(),this.similarArticle(),$(".special-product-blog-blocks").length>0&&this.customSpecialProduct(this.context),$("#list-product-blog-detail-block").length>0&&this.homeProductsListID();const t=window.location.href,e=$(".blog-tab-content__info .blog-tab-content__title.other-post-heading"),o=t.split("/").filter((t=>""!==t)).pop();e&&e.html(o)}loadOptionForProductCard(t){$("#featured-products .card").length>0&&haloAddOptionForProduct(t,"featured-products")}animationScroll(){let t=$(".tab-title__link");if(t)for(let e of t){let t=e.closest(".tab-title__item");e.addEventListener("click",(o=>{o.preventDefault();let r=document.querySelector(".tab-title__item.active");r&&r.classList.remove("active"),t.classList.add("active");let i=e.getAttribute("href");$("html, body").animate({scrollTop:$(i).offset().top-200},1e3)}))}}getBlogPostByTag(t){let e=document.querySelector(t),o=e?.closest(".blog-tab__content"),r=o?.querySelector(".blog-tab-content__link").getAttribute("href");e&&fetch(r).then((t=>t.text())).then((t=>{var o=document.createElement("div");o.innerHTML=t;var r=o.querySelector(".blog-catagory-content").innerHTML;r=r.split("<nav")[0],e.innerHTML=r})).then((()=>{if(window.innerWidth>768){let t=o.querySelectorAll(".blog-tab-content__post .blog");for(let e=0;e<t.length;e++)e>8&&t[e].remove()}})).then((()=>{if(window.innerWidth<768){let t=o.querySelectorAll(".blog-tab-content__post .blog");for(let e=0;e<t.length;e++)e>2&&t[e].remove()}})).then((()=>{$(t).slick({infinite:!1,slidesToShow:3,slidesToScroll:3,arrows:!1,draggable:!0,dots:!0,responsive:[{breakpoint:900,settings:{slidesToShow:2,slidesToScroll:2,dots:!0}},{breakpoint:767,settings:{slidesToShow:1,variableWidth:!0,dots:!0,slidesToScroll:1}}]})})).then((()=>{o.querySelectorAll(".slick-dots li")[0].click()})).then((()=>{window.scrollTo(0,0)})).then((()=>{var t=document.querySelectorAll(".blog-post.halo-description");for(let o of t){var e=o.textContent.trim().match(/(\d+\smin\sde\scitit)/i);if(e)e=e[0],o.closest(".blog-post-body").querySelector(".custom-blog-reading").textContent=e,o.textContent=o.textContent.replace(e,"").trim()}})).then((()=>{if(document.querySelector(".custom-post-detail-layout")){document.querySelectorAll(".custom-post-tags .link").forEach((t=>{const e=t.innerText.trim(),o=document.getElementById("blog-"+e.toLowerCase());o&&(o.style.display="block")}))}})).catch((t=>{console.error("Error:",t)}))}viewMoreBlogCategory(){let t=document.querySelector(".post-category-viewMore"),e=document.querySelector(".blog-catagory-content");t&&t.addEventListener("click",(o=>{o.preventDefault();var r=$(".pagination-item--current").next().find("a").attr("href");fetch(r).then((t=>t.text())).then((t=>{var o=document.createElement("div");o.innerHTML=t;var i=$(".blog-catagory-content .blog",$(o)),l=$(".pagination-list",$(o));r&&$(i).appendTo(e),$(".pagination-list").html(l)})).then((()=>{document.querySelector(".pagination-item--next")||(t.style.display="none")})).catch((t=>{console.error("Error:",t)}))}))}getTimeBlog(){var t=document.querySelectorAll(".blog-post.halo-description");for(let r=0;r<t.length;r++){var e=t[r].innerHTML.trim().match(/(\d+\smin\sde\scitit)/i);if(e){e=e[0],t[r].closest(".blog").querySelector(".custom-blog-reading").innerHTML=e;let i=document.querySelector(".blog-post-detail .post-detail__top");if(i){function l(t){const e=t.match(/(\d+)\s*min\s+de\s+citit/);if(e&&e[1]){return`${parseInt(e[1])} minute`}return t}var o=i.querySelector(".custom-blog-reading");l(e);0==r&&(o.innerHTML=l(e))}t[r].innerHTML=t[r].innerHTML.replace(e,"").trim()}}}similarArticle(){let t=document.querySelector(".blog-post-tags .tags .tag .link")?.getAttribute("href");t&&fetch(t).then((t=>t.text())).then((t=>{var e=document.createElement("div");e.innerHTML=t;var o=e.querySelector("#blog-listing-container .blog-tab__content .blog-catagory-content").innerHTML;o=o.split("<nav")[0],document.querySelector(".similar-blog__list").innerHTML=o})).then((()=>{let t=document.querySelectorAll(".similar__wrapper .blog");for(let e=0;e<t.length;e++)e>2&&t[e].remove()})).then((()=>{var t=document.querySelectorAll(".similar__wrapper .blog-post.halo-description");for(let o of t){var e=o.textContent.trim().match(/(\d+\smin\sde\scitit)/i);if(e)e=e[0],o.closest(".similar__wrapper .blog-post-body").querySelector(".similar__wrapper .custom-blog-reading").textContent=e,o.textContent=o.textContent.replace(e,"").trim()}})).then((()=>{$(document).ready((function(){$(".similar-blog__list").slick({infinite:!1,slidesToShow:3,slidesToScroll:3,arrows:!1,draggable:!0,dots:!0,responsive:[{breakpoint:900,settings:{slidesToShow:2,slidesToScroll:2,dots:!0}},{breakpoint:767,settings:{slidesToShow:1,variableWidth:!0,dots:!0,slidesToScroll:1}}]})}))}))}customSpecialProduct(t){const e=t;var o=$("[data-special-product-blog-id]").data("special-product-blog-id"),r=!1;const i={template:"halothemes/product/halo-special-product-blog-tmp"};$(window).on("scroll load",(function(){if($(window).scrollTop()>$(".header").height()&&(r=!0),r){if(!$(".halo-spacial-product .productView").length){function t(t){if(t.length>0){var o=e.themeSettings.product_viewingProduct_text,r=e.themeSettings.product_viewingProduct_viewer,i=JSON.parse("["+r+"]");setInterval((function(){var e=Math.floor(Math.random()*i.length);t.html('<svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye"/></svg>'+i[e]+" "+o),t.removeClass("u-hiddenVisually")}),1e4)}}function l(t){var e=$(t),o=(e.find(".productView-nav"),e.find(".productView-for"));o.find(".slick-arrow").length>0?o.parent().addClass("arrows-visible"):o.parent().addClass("arrows-disable")}utils.api.product.getById(o,i,((o,i)=>{r=!1;var n=".halo-spacial-product";if(!$(n).find(".productView").length){$(n).html(i),t($(n).find(".productView-ViewingProduct")),$(n).find("[data-slick]").slick(),$(n).find(".productView-for").get(0).slick.setPosition(),l(n),$(n).on("click",".dropdown-menu-button",(t=>{var e=$(t.currentTarget);e.hasClass("is-open")?(e.removeClass("is-open").attr("aria-expanded",!1),e.siblings(".dropdown-menu").removeClass("is-open").attr("aria-hidden",!0)):(e.addClass("is-open").attr("aria-expanded",!0),e.siblings(".dropdown-menu").addClass("is-open").attr("aria-hidden",!1)),t.stopPropagation()})),$(document).on("click",(t=>{$(n).find(".dropdown-menu-button").hasClass("is-open")&&0===$(t.target).closest(".dropdown-menu-button").length&&0===$(t.target).closest(".dropdown-menu").length&&($(n).find(".dropdown-menu-button").removeClass("is-open").attr("aria-expanded",!1),$(n).find(".dropdown-menu-button").siblings(".dropdown-menu").removeClass("is-open").attr("aria-hidden",!0))}));var s=new ProductDetails($(n),e);return s.setProductVariant(),s}}))}r=!1}}))}homeProductsListID(){var t;function e(e){$(".productsByListId[data-list-id]").length>0&&$(".productsByListId[data-list-id]").each(((r,i)=>{let l=$(i).offset().top-1.5*screen.height;if(e>l&&!$(i).hasClass("is-loaded")){$(i).addClass("is-loaded");var n,s=$(i).attr("id"),a=$(i).data("list-id"),d=$(i).parents(".product-block").data("columns"),c=$(i).parents(".product-block").data("dots"),p=$(i).parents(".product-block").data("limit");$(i).find(".productCarousel1").length>0&&(n=$(i).find(".productCarousel1"),t={template:"halothemes/product/halo-special-product-blog-tmp"}),$("#product-by-list-"+s+" .productCarousel1 .productCarousel-slide").length||(a.length>1?o(a,t,n,d,c,p):o($(a),t,n,d,c,p))}}))}function o(t,e,o,i,l,n){if(t.length<=1)var s=t;else s=t.split(",");if(t.length>i)var a=s.slice(0,parseInt(n));else a=s;for(var d=0,c=0;c<=a.length;c++){var p=a[c];null!=p&&utils.api.product.getById(p,e,((t,e)=>{$(e).find(".card").data("product-id");if(o.hasClass("slick-slider")?(o.slick("unslick"),o.append(e)):o.append(e),++d!=a.length);else if(o.parents(".productsByListId[data-list-id]").find(".halo_productLoading").remove(),o.parents(".productsByListId[data-list-id]").addClass("show"),$(window).width()<=767){$("#list-product-blog-detail-block-mb").append($("#list-product-blog-detail-block"));r($("#list-product-blog-detail-block-mb .productCarousel1"),1,l)}}))}}function r(t,e,o){t.slick({infinite:!1,slidesToShow:3,slidesToScroll:3,arrows:!1,draggable:!0,dots:!0,responsive:[{breakpoint:900,settings:{slidesToShow:2,slidesToScroll:2,dots:!1}},{breakpoint:767,settings:{slidesToShow:1,variableWidth:!0,dots:!1,slidesToScroll:1}}]})}$(document).ready((function(){e($(this).scrollTop())})),$(window).on("scroll",(t=>{e($(t.currentTarget).scrollTop())}))}}